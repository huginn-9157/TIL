# ワークフロー管理

OS上でバッチ処理の自動化が出来ればそれで良いが、  
データパイプラインが複雑になるとそうもいかなくなるのでツールを使う

スクリプト型と宣言方

## リカバリーの際の留意点

- バックフィル
  - フロー全体を最初から実行しなおすこと
- アトミック操作
  - フローをリトライする際、例えばSQL文で同じINSERTが起きないようにすること
  - トランザクションを一つにまとめられない場合、その数だけタスクを分割する
- 冪等（べきとう）な操作
  - 何度やっても同じ結果になるようにすること
  - SQLであれば、`CREATE TABLE`の前に`DROP TABLE`する
- 冪等な追記
  - INSERTの場合、そのままでは冪等にならない
  - テーブルを集計日時単位でパテーションに分割し、その単位で置換を行う
  - データマート構築の際も、なるべく追記は分け、まとまりごとに置換すべき
  - リトライ時の重複が問題なのであって、全ての追記が冪等である必要は無い

## 自動化の際の留意点

タスクキュー
- 使うマシンのリソース管理
- どこがボトルネックかを把握し、それに合わせたリソースを割り当てる。

ワークフロー実行時によく発生する問題
- CPU100%
- メモリ不足
- ディスク溢れ
- ディスクI/O
- ネットワーク帯域
- 通信エラーやタイムアウト

## バッチ型のデータフロー

>多段階のデータ処理を分散システム内部で実行すること

外部ツールに依存するワークフローと区別する意の言葉

代表的なフレームワーク
- Google Cloud Dataflow
- Apache Spark
- Apache Flink
